
{% extends "layouts/base.html" %}

{% block TITLE %} â€¢ Data Explorer{% endblock %}

{% block HEAD %}
<!-- Vendor CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
<link href="https://cdn.jsdelivr.net/npm/tablesorter@2.31.3/dist/css/theme.bootstrap_4.min.css" rel="stylesheet">

<!-- Re-apply app CSS after vendor to preserve original cascade -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/ui.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/fonts.css') }}">

<!-- Page CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/polcomp.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/data.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/table.css') }}">

<meta id="compass-data" data-compass='{{ data["compass_datasets"]|safe }}'>
{% endblock %}

{% block CONTENT %}

<div class="components-50-50">
    <div class="component-border">
        <div class="components-25-75" id="results-section">
            <div class="component-border component" style="justify-content:center">
                <p class="text text-subtitle fade-border header-underline">Data Explorer</p>
                <p class="text">
                    This chart shows results that match your current filters. Each colored point is one result.
                    The larger dot in each color is that filter set's average position.
                </p>
                <p class="text">
                    If you've taken the test on this device, your result will appear as four <b>pink</b> points.
                </p>
            </div>
            <div class="component">
                {% include "components/compass.html" %}
            </div>
        </div>

        <div class="components-50-50">
            <div class="component-border component" style="justify-content: center;">
                <p class="text text-subtitle fade-border header-underline">Quick Presets</p>
                <p class="text">Pick a preset to load a ready-made comparison.</p>
            </div>

            <div class="component-border component">
                <select
                    id="preset-select"
                    style="width:100%; text-align:center;"
                    class="button save-button grey-button"
                    onchange="apply_preset(event.target.value)"
                    disabled
                >
                    <option value="all_users" selected>All Users</option>
                </select>

                <p id="preset-desc" class="text" style="margin-top: 8px;"></p>
                <p id="preset-status" class="text" style="font-weight: 600; color: salmon; margin-top: 0;"></p>
            </div>
        </div>
    </div>
</div>

<div class="component-border component">
    <div class="components-50-50">
        <div class="component-border component" style="justify-content: center;">
            <p class="text text-subtitle fade-border header-underline">Custom Filters</p>
            <p class="text">
                Build up to <b>4 filter sets</b> to compare groups in the dataset (country, party, ideology, demographics, and more).
            </p>
            <p class="text">
                Use the controls to change <b>sample size</b>, <b>sampling method</b> (random vs. most recent), and the <b>date range</b>.
            </p>

        </div>

        <div class="component-border component">
            <div class="input-box-container" style="width: 100%;">
                <input type="number" name="sample-size" class="age-box a-l grey-button" placeholder="Sample size" value="1000" min="1" max="2500">
                <div style="width: 50%; height: auto;" class="age-box a-r">
                    <input type="radio" class="radio-selector" name="sorting" id="random" value="random" checked>
                    <input type="radio" class="radio-selector a-r" name="sorting" id="recent" value="recent">
                </div>
            </div>

            <div class="input-box-container" style="width: 100%;">
                <input onclick="this.showPicker()" type="date" name="min-date" class="age-box a-l grey-button" value="2023-01-01" min="2023-01-01" max="2030-01-01">
                <input id="todays-date" onclick="this.showPicker()" type="date" name="max-date" class="age-box a-r grey-button" min="2021-01-01">
            </div>

            <br>
            <button id="addfiltersetbtn" class="button" onclick="add_filterset(event)"><i class="fa-solid fa-plus"></i>Add Filter set</button>
            <button id="rmfiltersetbtn" disabled class="button disabled" onclick="remove_filterset(event)"><i class="fa-solid fa-minus"></i>Remove Filter set</button>
            <button id="applyfilters" class="button blue-button" onclick="apply_filters()"><i class="fa-solid fa-play"></i>Apply Filters</button>

            <div id="statusmsg"></div>
        </div>
    </div>

    <div class="component-border component" style="overflow: hidden;">
        <div class="showmore-var filterset-grow" id="filters-div">
            <div class="filterset-container">
                <div id="filterset1" class="component-border filterset">
                    {% with i=1, color="#0db52e" %}
                        {% include "components/filterset.html" %}
                    {% endwith %}
                </div>
                <div id="filterset2" class="component-border hidden filterset">
                    {% with i=2, color="#0d56b5" %}
                        {% include "components/filterset.html" %}
                    {% endwith %}
                </div>
                <div id="filterset3" class="component-border hidden filterset">
                    {% with i=3, color="#7a0db5" %}
                        {% include "components/filterset.html" %}
                    {% endwith %}
                </div>
                <div id="filterset4" class="component-border hidden filterset">
                    {% with i=4, color="#bf2b11" %}
                        {% include "components/filterset.html" %}
                    {% endwith %}
                </div>
            </div>
        </div>
        <span class="show-more fade-border" id="filters-link"><button class="inline-link large-link link" onclick="show_more('filters', 'Hide Filters', 'Show Filters')">Show Filters</button></span>
    </div>
</div>

<div class="components-50-50">
    <div class="component-border">
        {% include "components/histogram.html" %}
    </div>
</div>

<div class="components-50-50">
    <div class="component-border">
        <div class="components-25-75">
            <div class="component">
                <div class="component-border fill" style="flex-direction: column;">
                    <p class="text text-subtitle fade-border header-underline">Question Explorer</p>
                    <p class="text">
                        The chart shows the response split for the selected question, grouped by filter set, so you can compare how different groups answered.
                    </p>
                    <p class="text">
                        Click a question in the table below to see how each filter set responded.
                    </p>
                </div>
            </div>
            <div class="component">
                {% include "components/pie.html" %}
            </div>
        </div>

        <div class="components-50-50">
            <div class="component-border component table-container">
                <p class="text text-subtitle">Questions Table</p>
                <div class="table-container showmore-var table-grow" id="questions-div">
                    <table id="questions-table" class="questions-table tablesorter">
                        <thead>
                            <tr>
                                {% for key in ["ID", "Question", "Society", "Politics", "Economics", "State", "Diplomacy", "Government", "Technology", "Religion"] %}
                                    <th scope="col" class="table-button">{{key}}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for question in data["questions"] %}
                                <tr id='qid_{{ question["id"] }}' class="row-highlight" onclick="select_table_row(event)">
                                    {% for key in ["id", "text", "society", "politics", "economics", "state", "diplomacy", "government", "technology", "religion"] %}
                                        <td scope="col">{{question[key]}}</td>
                                    {% endfor %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <span class="show-more fade-border" id="questions-link"><button class="inline-link large-link link" onclick="show_more('questions')">Show more...</button></span>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block SCRIPTS %}
<!-- Vendor JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3@7.8.3/dist/d3.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dom-to-image@2.6.0/dist/dom-to-image.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tablesorter@2.31.3/dist/js/jquery.tablesorter.combined.min.js"></script>

<script src="{{ url_for('static', filename='js/data.js') }}"></script>

<!-- Vendor JS required for bootstrap-select -->
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
{% endblock %}
